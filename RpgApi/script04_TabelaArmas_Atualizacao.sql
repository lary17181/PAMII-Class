BEGIN TRANSACTION;
ALTER TABLE [TB_ARMAS] DROP CONSTRAINT [FK_TB_ARMAS_TB_PERSONAGENS_PersonagemId];

DROP INDEX [IX_TB_ARMAS_PersonagemId] ON [TB_ARMAS];

DECLARE @var sysname;
SELECT @var = [d].[name]
FROM [sys].[default_constraints] [d]
INNER JOIN [sys].[columns] [c] ON [d].[parent_column_id] = [c].[column_id] AND [d].[parent_object_id] = [c].[object_id]
WHERE ([d].[parent_object_id] = OBJECT_ID(N'[TB_ARMAS]') AND [c].[name] = N'PersonagemId');
IF @var IS NOT NULL EXEC(N'ALTER TABLE [TB_ARMAS] DROP CONSTRAINT [' + @var + '];');
UPDATE [TB_ARMAS] SET [PersonagemId] = 0 WHERE [PersonagemId] IS NULL;
ALTER TABLE [TB_ARMAS] ALTER COLUMN [PersonagemId] int NOT NULL;
ALTER TABLE [TB_ARMAS] ADD DEFAULT 0 FOR [PersonagemId];

UPDATE [TB_USUARIOS] SET [PasswordHash] = 0x8676817B91B27CEE00DE41CCDDFF86C90E3975529D2658A7AE1A093EA2D25E7B287B74C171B4EE9ABDEDB2733FD07C48FE4C2AD327CBC6CD462E14818FCEC243, [PasswordSalt] = 0x2B024C9ECCD2D68BD6E11399211813475423EBEC17EE1005128C6635BBB94D90255FBD125FEB8FEBC91CC54FB1434ACF5A403375F68025ED75B3003FF541903E592DBE84630803CD871CE73E070BA14771377CFF1C9046027A52BA7B53FC489C854B144725DBF7DD6AD6B8D5E19E5DE9591E8C4F61105A158EDC1D73DB271768
WHERE [Id] = 1;
SELECT @@ROWCOUNT;


CREATE UNIQUE INDEX [IX_TB_ARMAS_PersonagemId] ON [TB_ARMAS] ([PersonagemId]);

ALTER TABLE [TB_ARMAS] ADD CONSTRAINT [FK_TB_ARMAS_TB_PERSONAGENS_PersonagemId] FOREIGN KEY ([PersonagemId]) REFERENCES [TB_PERSONAGENS] ([Id]) ON DELETE CASCADE;

INSERT INTO [__EFMigrationsHistory] ([MigrationId], [ProductVersion])
VALUES (N'20250414171534_MigracaoUmParaUm', N'9.0.2');

COMMIT;
GO

